<!DOCTYPE html>
<html>
  <head>
    <title><%= title %></title>
    <link rel="stylesheet" href="/stylesheets/style.css" />
  </head>
  <body>
    <h1>mongodb增删改查的演示</h1>
    <div>用户名：<input id="username" /></div>
    <div>密 码：<input type="password" id="password" /></div>
    <div>年 龄：<input type="number" id="age" /></div>
    <div><button id="register">注册</button></div>
    <hr />
    <div>
      <button id="update">更新</button>
      <button id="delete">删除</button>
    </div>

    <table border="1">
      <thead>
        <td>id</td>
        <td>用户名</td>
        <td>年龄</td>
      </thead>
      <tbody></tbody>
    </table>

    <script>
      var username = document.querySelector("#username");
      var password = document.querySelector("#password");
      var age = document.querySelector("#age");
      var register = document.querySelector("#register");
      var update = document.querySelector("#update");
      var handleDelete = document.querySelector("#delete");

      // 注册
      register.onclick = () => {
        console.log(username.value, password.value, age.value);
        fetch("/api/user", {
          method: "POST",
          body: JSON.stringify({
            username: username.value,
            password: password.value,
            age: age.value,
          }),
          headers: {
            "Content-Type": "Application/json",
          },
        })
          .then((res) => res.json())
          .then((res) => {
            console.log(res);
          });
      };

      // 更新
      update.onclick = () => {
        fetch("/api/user/637617f53fa9365df092f85a", {
          method: "PUT",
          body: JSON.stringify({
            username: username.value,
            password: password.value,
            age: age.value,
          }),
          headers: {
            "Content-Type": "Application/json",
          },
        })
          .then((res) => res.json())
          .then((res) => {
            console.log(res);
          });
      };

      // 删除
      handleDelete.onclick = () => {
        fetch("/api/user/63762a0cf936b95e1c8170dd",{
          method:'DELETE'
        })
          .then((res) => res.json())
          .then((res) => {
            console.log(res);
          });
      };

      // 获取列表
      fetch("/api/user?page=1&limit=10")
        .then((res) => res.json())
        .then((res) => {
          console.log(res);
          const list = res;
          const el = document.querySelector("tbody");
          el.innerHTML = list.map(
            (item) =>
              `<tr>
              <td>${item._id}</td>  
              <td>${item.username}</td>  
              <td>${item.age}</td>  
            </tr>`
          ).join('')
        });
    </script>
  </body>
</html>
